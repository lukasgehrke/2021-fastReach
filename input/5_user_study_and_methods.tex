
\section{Methods}

% With this study we wanted to find out whether agency can be preserved during \textit{physical actuation} of the user's body when their own brain signals serve as the control signal. To this end, we build a system that leverages the brain signals known to reflect the volitional intent to interact, i.e. the EEG readiness potential, to trigger electrical muscle stimulation to cue a reaching movement.

Our idea to overcome this disruption in agency is to use EEG signals reflecting the intent to (inter)act and leverage them for the control of an end-effector, here EMS. We trained an EEG classifier to discriminate between two user states and applied it in real-time: either the user is predicted to be in an \textit{idle}-- or a \textit{pre-movement} state. Is the user predicted to be in a \textit{pre-movement} state, EMS is triggered, augmenting their action.

\input{input/4_prototype}

To assess whether our prototype preserves agency during action augmentation, we used a mixed methods approach including a psychometric test of intentional binding, questionnaires as well as qualitative interviews. Our interviews followed a phenomenological structure~\citep{Danry2022-xk}.

\subsection{User study}

\subsubsection{Participants}

\todo{add actual number} Ten participants (\todo{add mean age and sd}) from our local institution participated in our study. All participants were right handed, had normal or corrected to normal vision and had not experienced EMS before. Participants were compensated with 12 Euro per hour of study participation. Prior to their participation, participants were informed of the nature of the experiment, recording and anonymization procedures and signed a consent form.

\subsubsection{Apparatus}
\todo{add the components that were used to run the STUDY, touchpad, keyboard etc.}
The experimental setup, depicted in Figure~\ref{}, comprised: (1) a wrist-mounted wearable HTC VIVE tracker for motion capture, (2) a 64-channel EEG system, and (3) a medically-compliant EMS device connected via two electrodes worn on the forearm. To assist readers in replicating our experiment, we provide the necessary technical details, the complete source code to the experiment, the collected data, and the analysis scripts\footnote{[anonymized]}.

% TODO change this to the use of EMG for now
\indent\textbf{(1) Hand Tracking.} We used an HTC Vive Tracker, attached to the participant's wrist, to track their right hand at 90Hz. Therefore, we ran a simple Unity3D scene and streamed the data via the labstreaminglatyer (LSL)\footnote{https://github.com/sccn/labstreaminglayer}.

\indent\textbf{(2) EEG Recording.} EEG data was recorded from 64 actively amplified Ag/AgCl electrodes in an actiCap Snap cap using BrainAmp DC amplifiers from BrainProducts. Electrodes were placed according to the extended international 10â€“20 system \cite{Chatrian1985-ys}. One electrode was placed under the left eye to provide additional information about eye movements (vEOG). After fitting the cap, all electrodes were filled with conductive gel to ensure proper conductivity and electrode impedance was brought below 10k$\Omega$ for all electrodes. EEG data was recorded with a sampling rate of 250 Hz. We used LSL to make the EEG data stream available in the network and synchronize the recordings of EEG data, motion capture and an experiment marker stream that marked sections of the study procedure.

\missingfigure{show participant with measurement system and description next to each element}

\indent\textbf{(3) Electrical Muscle Stimulation.} We actuated the index finger via electrical muscle stimulation (EMS), which was delivered via two electrodes attached to the participants' extensor digitorum muscle. We utilized the extensor digitorum since we found that we can robustly actuate it without inducing parasitical motion of neighboring muscles. This finger actuation was achieved via a medically-compliant battery powered muscle stimulator (prorelax TENS/EMS Super Duo Plus). The EMS system's output was controlled by flipping a solid state relay connected via an Arduino Uno to the experiment computer. The EMS was pre-calibrated per participant to ensure a pain-free stimulation and robust actuation.

\subsubsection{Task}
\missingfigure{add an infographic of the task progression with a time axis here, this should be covering two columns and be at the top of the page!}
Participants performed a simple reaching task: resting their hand on the table, participants were instructed to press a specified key on a notebook in front of them. For each trial, a key was randomly selected from one of two groups of letters: (1) 'a', 's', 'd' or (2) 'j', 'k', 'l'. The selected group was then changed with every trial. This was done to keep the task engaging while maintaining a comparable reaching movement between trials.

The interaction flow for one trial of our task, depicted in Figure~\ref{task_flow}, was as follows: (1) participants waited for a new letter to appear on screen; (2) then, they were instructed to wait for a brief moment (~2s), before (3) reaching out and pressing the key. In line with the literature on the origin of the RP generating process they were told "to avoid preplanning the movement, avoid any obvious rhythm, and to press when they felt the spontaneous urge to move". (4) Two \todo{how many, but do keep this constant in order for them to focus on the duration of their action} seconds after they pressed the key, they were presented with a tone and asked to judge whether their movement, from the start of their reach to the button press, lasted longer or shorter than the tone. (5) When they perceived the tone to be longer, they had to press the up key or vice versa the down key for perceiving that the tone was shorter than their movement. Following an inter-trial-interval the next trial started.

\subsubsection{Experiment Design and Procedure}
Participants completed three experimental blocks. The first block consisted of 60 trials and was used to obtain training data for the single-trial classification system outlined below. 

%The condition of the second and third block, see below, were alternated between participants.

In a second block, participants completed 80 trials of the same task and trial order as in the first block. Now, the brain-computer interface (BCI) detecting readiness potentials from real-time EEG data was continuously running in the background. After the target letter was shown to the participants and they were preparing to reach out and press the corresponding key, the BCI was live. Whenever the BCI detected EEG signals to reflect an interaction intent, EMS was activated causing the participants index finger to lift. 

Both experimental blocks two and three were followed by a mixed methods data collection of participants' perceived agency.

In summary, the experiment consisted of four phases: (1) a setup phase; (2) a first experimental block: the training phase; (3) a second experiment block: the test phase; and (4) a test battery of questionnaire and interview to inquire about their experienced agency.

\subsubsection{Measures of agency experience: Intentional Binding, Questionnaire \& Interview}

To assess if agency was preserved, three measures were recorded during and after the test phase.

\indent\textbf{(1) Intentional Binding.}
At the end of each trial participants were tasked to compare the duration of their arm movement to a tone and indicate whether the tone was longer or shorter. We set the initial duration at 500 ms for each participant. When participants indicated the tone to be longer or shorter by pressing either the up or down key we added, or respectively subtracted, 100 ms from the tone duration. This new duration was then used for the next trial and so on. With 60 trials in the training phase, we hypothesized participants would oscillate 50-50 around a target duration after about 2/3 of the training trials. The final duration after all training trials was then used again as the start duration during the test phase. In line with the literature on intentional binding, we hypothesized this duration to remain stable in the case that agency was preserved during the test phase with EMS. A deviation of the tone duration from the training phase was hypothesized to reflect a disruption in experienced agency.

\indent\textbf{(2) Questionnaire.}
In line with~\cite{Hornbaek} we prompted participants with three statements and a 7-point Likert scale centered at 0. The first one ``I felt like the device I was using was part of my body'' was in relation to body ownership. The following two statements ``It felt like I was in control of the movements during the task.'' and ``What is the degree of control you felt?'' prompted participants on their experienced agency.

\indent\textbf{(3) Interview.}
We interviewed user's about the experience with the EMS integration. We asked open how questions in a collaborative interview inquiring about the user's lived experience. After prompting user's to recall their experience we started the interview with: "how did it feel like?". If user's made reference themselves to the EMS device we followed up by inquiring: "why do you think it (the EMS trigger) happened?", "What do you think triggered it?". The goal was to learn about the source attribution user's made about the EMS trigger. Since we leveraged the RP, we hypothesized that user's would attribute, at least in part, the EMS trigger to themselves, i.e. their movement intention. Next, we pressed deeper into learning about the cooperative nature between user and system. We asked "Do you believe you did it alone?" and when they made reference to a specific situation where the EMS was triggered we followed up with "What did it feel like, did you had the feeling the system controlled you or did you cooperate?" and "What would have to be there for it to feel like a cooperation?". We closed the interview with two additional exploratory questions: "Did the system influence your performance? If yes, how and why?" as well as asking them about any application scenarios they have in mind. 

To not break the user's immersion by disturbing the flow of the interaction we decided against asking qualitative questions at the end of each and every trial.

\subsubsection{Statistical Analyses}
\todo{how where the results analyzed: sentiment analyses and statistics of IB data and questionnaire results}

% ERP with significance mask for Cz? Assessing significance of classifier

% IB Task: ttest of final ib time between with and without EMS -> # subjects input values
% did they increase the IB task in more than 50% of the trials after EMS?

% questionnaires: ttest against zero to report direction

% interviews: anecdotal summary and sentiment analyses with two groups splitting questionnaires at 0

% correlation with EEG classifier accuracy?

% evaluation of EEG classifier: can report false negatives, how often was it missing to predict a movement onset? hand was moving without EMS being triggered occurred how often? Not possible to evlaute false positives as no ground truth available

\subsubsection{Reproducing Results and Data Availability}
Data, experimental protocol, analyses code including scripts for a reproduction of the presented results are hosted at open science foundation (OSF)\footnote{[anonymized]}. BIDS formatted data is hosted on openneuro \cite{}.