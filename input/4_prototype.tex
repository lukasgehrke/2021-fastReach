\subsection{Controlling actuated haptic experiences using brain signals reflecting the intent to interact}

To discriminate between the two \textit{action} states, we leveraged the Readiness Potential (RP), or \textit{lateralized readiness potential}. It is an amplitude fluctuation that has been frequently observed preceding voluntary action~\cite{Deecke1969-bl, Libet1983-qu}. It is reliably observed in electrodes placed over the motor cortex contralateral to the acting hand. Since its measurable onset precedes the time of participants self-reported conscious movement intention, it has drawn much interest with respect to the debate on free will, see~\cite{Schurger2021-vp} for a recent neuroscientific perspective. However, evidence abounds for its role in action preparation. An RP is typically comprised of two stages: an early slow stage that begins up to two seconds before the actual movement and a late steep stage that starts about 400 milliseconds before movement. The first stage manifests in the pre-supplementary motor area and transfers to the premotor cortex shortly after. The second stage manifests contra-laterally in the primary motor cortex~\cite{Shibasaki2006-mt}. A recent study has shown that the RP is heavily ingrained in the subconscious mechanisms preceding movements that people cannot explicitly suppress~\cite{Schultze-Kraft2021-cu}. In their study,~\cite{Schultze-Kraft2021-cu} asked participants to find a way to perform a voluntary movement so that the accompanying RP amplitude was as small as possible. After each trial they informed participants about the strength of the RP in the current trial, so participants had a feedback metric to optimize for. They found participants unable to suppress their RP. This inability to suppress the RP renders it a reliable feature for classification.

% While its role in movement preparation remains somewhat controversial, it is established as a signal occurring during movement planning and motivates a usage as a reliable predictor of movement.



% \subsection{Action augmentation}
% TODO shorten this down to only the 'prototype' part -> EEG controlling the arduino switch. make obvious that what is attached to the switch can be different -> here in this particular study we used EMS -> see User Study

% \subsubsection{Apparatus}
% The experimental setup, depicted in Figure~\ref{}, comprised: (2) a 64-channel EEG system, and (3) a medically-compliant EMS device connected via two electrodes worn on the forearm. To assist readers in replicating our experiment, we provide the necessary technical details, the complete source code to the experiment, the collected data, and the analysis scripts\footnote{[anonymized]}.

% \indent\textbf{(2) EEG Recording.} EEG data was recorded from 64 actively amplified Ag/AgCl electrodes in an actiCap Snap cap using BrainAmp DC amplifiers from BrainProducts. Electrodes were placed according to the extended international 10â€“20 system \cite{Chatrian1985-ys}. One electrode was placed under the left eye to provide additional information about eye movements (vEOG). After fitting the cap, all electrodes were filled with conductive gel to ensure proper conductivity and electrode impedance was brought below 10k$\Omega$ for all electrodes. EEG data was recorded with a sampling rate of 250 Hz. We used LSL to make the EEG data stream available in the network and synchronize the recordings of EEG data, motion capture and an experiment marker stream that marked sections of the study procedure.

% \missingfigure{show participant with measurement system and description next to each element}

% \indent\textbf{(3) Electrical Muscle Stimulation.} We actuated the index finger via electrical muscle stimulation (EMS), which was delivered via two electrodes attached to the participants' extensor digitorum muscle. We utilized the extensor digitorum since we found that we can robustly actuate it without inducing parasitical motion of neighboring muscles. This finger actuation was achieved via a medically-compliant battery powered muscle stimulator (prorelax TENS/EMS Super Duo Plus). The EMS system's output was controlled by flipping a solid state relay connected via an Arduino Uno to the experiment computer. The EMS was pre-calibrated per participant to ensure a pain-free stimulation and robust actuation.

\subsection{Training of Classifiers from Training Phase Data}
% Brain-Computer Interface to Detect EEG Readiness Potentials }
% Classifiying EEG Signals of the Intent to Interact

Before the test phase of our experiment, the data recorded during the training phase was processed in three consecutive steps: (1) we extracted movement onsets in each trial to construct three event classes: an \textit{idle} class representing resting background activity, a \textit{movement} class and a \textit{pre-movement} class, representing the intent to interact. Next, (2) a motion classifier was trained on \textit{movement} and \textit{idle} data segments and (3) an EEG classifier was trained on \textit{pre-movement} and \textit{idle} data segments using 10 features from the 20 most informative EEG channels. To classify single-trial motion and EEG data we used a regularized linear discriminant analysis (LDA) that was trained for each participant individually. The EEG classifier was then used in the test phase to detect RPs and trigger EMS. The motion classifier was used to make the interaction more robust. When it detected the participants hand to be moving, it deactivated the control loop from RP to EMS.

\missingfigure{some picture from the setup and prototype}

\indent\textbf{(1) Labelling Pre-movement, Movement and Idle Data Segments.}
In order to obtain training data segments for the \textit{pre-movement} class, a detection algorithm was applied on the hand velocity time series. From the training data, the raw hand motion data was filtered with a 6Hz low-pass filter and re-sampled to match the EEG sample rate using BeMoBIL Pipeline functions \textit{xdf2bids} and \textit{bids2set}\footnote{https://github.com/BeMoBIL/bemobil-pipeline}. Subsequently the first derivative was computed and velocity was extracted. Then, for each trial a two step thresholding process was applied to extract the exact time of movement onset: (1) the first time point when the velocity exceeded 70\% of the maximum velocity in the trial was selected, then (2) the signal was flipped at that time point and the time point where the flipped signal first fell below 10\% of the maximum in the remaining data was selected as the movement onset.

The three event classes were then defined as follows: \textit{pre-movement} from -1000 to 0 ms preceding the movement onsets, \textit{movement} from 0 to 1000 ms succeeding the movement onsets and \textit{idle}, a one second data segment that fell exactly between two succeeding trials, i.e. time-locked to the inter-trial-interval. Here, participants where looking at a fixation cross on the screen with their hand resting on the table.

\indent\textbf{(2) Training of Hand Motion Classifier.}
An LDA was trained using the mean velocity per trial and movement and idle time segment. Hence, 60 values for each class were subjected to train the motion classifier. Since in the idle time segments almost no movement occurred we added some artificial noise. To this end, the idle features were multiplied by a factor of 3, chosen by simple trial and error. In the real-time feedback, this rendered the classifier less susceptible to false positives, i.e. detecting a movement when there was none.

\indent\textbf{(3) Channel Selection \& Training of EEG Classifier.}
For the EEG classifier, we followed the approach outlined by Schultze-Kraft et al.\cite{} with slight modifications. First, the 20 channels with the strongest discrimination between \textit{pre-movement} and \textit{idle} segments were selected with the following procedure. For both \textit{pre-movement} and \textit{idle} the mean signal in the last 100 ms of each segment was subtracted from the mean signal in the first 100ms of the segment. The resulting value thus indicated how much the signal had changed in the course of the 1s segments. In line with the literature there should be a change over time in the \textit{pre-movement} segment but not in the \textit{idle} segment. Then, all channels were sorted (1) in descending order by the signal difference in the \textit{pre-movement} segments and (2) in ascending order by the signal difference in the \textit{idle} segments. The idea was, that an ideal channel shows a strong change in signal over the course of a \textit{pre-movement} segment but shows no difference during a \textit{idle} segment. The ranks were joined and the 20 best channels were selected. In any case, channels C3, C4 and Cz were kept for every participant as these are most frequently reported in studies on the RP.

To train the LDA EEG classifier, we extracted spatiotemporal features from the EEG; 10 windowed means were extracted for each segment and channel. These were baseline corrected by subtracting the mean of the last 100 ms preceding the segment. The features were concatenated across all 20 selected channels and 10 time windows to obtain a 200 dimensional spatiotemporal feature vector per \textit{pre-movement} and \textit{idle} segment.

\subsubsection{Real-time Feedback}

During the test phase, both classifiers were applied to the real-time data. With the motion data streaming at 90 Hz we subjected the current sample to the motion classifier. For the EEG data streaming at 250 Hz, the EEG data of the last 1000ms was buffered for the selected best channels and 10 windowed means per channel were computed. Identical to the training data, these features were baseline corrected by subtracting the mean from the last 100 ms preceding the last second, i.e. -1100 ms to -1000 ms, resulting in a 200 dimensional baseline corrected spatiotemporal feature vector. Hence, both classifiers yielded one output value at each sample point.

The EMS was triggered whenever the EEG classifier predicted the \textit{pre-movement} class with an above .7 probability. Additionally, EMS was only triggered when the hand was \textit{not} moving. In each trial, as soon as the hand was in motion once after trial start, the EEG-EMS control was deactivated for the rest of the trial. This guaranteed that participants experienced EMS only during movement preparation.